{% extends 'base.html' %} {% block title %}GitHub Build - AppCenter{% endblock
%} {% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="fw-bold mb-1">GitHub Build</h1>
        <p class="text-muted">
          Build iOS applications directly from source code repositories
        </p>
      </div>
      <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Apps
      </a>
    </div>

    <div class="row">
      <div class="col-lg-5">
        <!-- Build Form -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fab fa-github me-2"></i>New GitHub Build
            </h5>
          </div>
          <div class="card-body p-4">
            <form
              action="{{ url_for('github_build') }}"
              method="post"
              enctype="multipart/form-data"
            >
              <div class="mb-3">
                <label for="repo_url" class="form-label"
                  >GitHub Repository URL</label
                >
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fab fa-github"></i
                  ></span>
                  <input
                    type="url"
                    class="form-control"
                    id="repo_url"
                    name="repo_url"
                    placeholder="{{ github_repo_url }}"
                    required
                  />
                </div>
                <div class="form-text">
                  URL of the GitHub repository containing your iOS app
                </div>
              </div>

              <div class="mb-3">
                <label for="branch" class="form-label">Branch</label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-code-branch"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control"
                    id="branch"
                    name="branch"
                    value="main"
                    required
                  />
                </div>
                <div class="form-text">
                  The branch to build from (e.g., main, develop)
                </div>
              </div>

              <div class="mb-3">
                <label for="app_name" class="form-label">App Name</label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-mobile-alt"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control"
                    id="app_name"
                    name="app_name"
                    placeholder="Optional, will use project name if not specified"
                  />
                </div>
                <div class="form-text">
                  Override the app name or leave blank to use project name
                </div>
              </div>

              <div class="mb-3">
                <label for="build_config" class="form-label"
                  >Build Configuration</label
                >
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-cog"></i
                  ></span>
                  <select
                    class="form-select"
                    id="build_config"
                    name="build_config"
                  >
                    <option value="Release" selected>Release</option>
                    <option value="Debug">Debug</option>
                  </select>
                </div>
              </div>

              <div class="mb-3">
                <label for="team_id" class="form-label">Apple Team ID</label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fab fa-apple"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control"
                    id="team_id"
                    name="team_id"
                    placeholder="Your Apple Developer Team ID"
                  />
                </div>
                <div class="form-text">Required for signing the build</div>
              </div>

              <div class="mb-3">
                <label for="xcode_version" class="form-label"
                  >Xcode Version</label
                >
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-tools"></i
                  ></span>
                  <select
                    class="form-select"
                    id="xcode_version"
                    name="xcode_version"
                  >
                    <option value="latest" selected>Latest Available</option>
                    <option value="15.0">Xcode 15.0</option>
                    <option value="14.3">Xcode 14.3</option>
                    <option value="14.2">Xcode 14.2</option>
                    <option value="14.1">Xcode 14.1</option>
                    <option value="14.0">Xcode 14.0</option>
                    <option value="13.4">Xcode 13.4</option>
                  </select>
                </div>
              </div>

              <div class="mb-4">
                <label class="form-label">Signing Files (Optional)</label>
                <div class="mb-3">
                  <div class="input-group">
                    <span class="input-group-text"
                      ><i class="fas fa-certificate"></i
                    ></span>
                    <input
                      type="file"
                      class="form-control"
                      id="certificate"
                      name="certificate"
                      accept=".p12,.cer"
                    />
                    <label class="input-group-text" for="certificate"
                      >Certificate</label
                    >
                  </div>
                  <div class="form-text">
                    P12 or CER certificate file for signing
                  </div>
                </div>

                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-id-card"></i
                  ></span>
                  <input
                    type="file"
                    class="form-control"
                    id="provisioning_profile"
                    name="provisioning_profile"
                    accept=".mobileprovision,.provisionprofile"
                  />
                  <label class="input-group-text" for="provisioning_profile"
                    >Profile</label
                  >
                </div>
                <div class="form-text">Provisioning profile for the app</div>
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-rocket me-2"></i>Start Build
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-lg-7">
        <!-- Recent Builds -->
        <div class="card border-0 shadow-sm">
          <div
            class="card-header d-flex justify-content-between align-items-center"
          >
            <h5 class="mb-0">
              <i class="fas fa-history me-2"></i>Recent Builds
            </h5>
            <span class="badge bg-secondary">{{ builds|length }} Build(s)</span>
          </div>

          {% if builds %}
          <div class="list-group list-group-flush">
            {% for build in builds %}
            <div class="list-group-item list-group-item-action p-3">
              <div
                class="d-flex w-100 justify-content-between align-items-center mb-2"
              >
                <h6 class="mb-0 fw-bold">
                  {% if build.app_name %} {{ build.app_name }} {% else %} GitHub
                  Build {% endif %}
                </h6>

                <div>
                  {% if build.status == 'completed' %}
                  <span class="status-badge status-completed">
                    <i class="fas fa-check-circle"></i> Completed
                  </span>
                  {% elif build.status == 'queued' %}
                  <span class="status-badge status-queued">
                    <i class="fas fa-clock"></i> Queued
                  </span>
                  {% elif build.status == 'building' or build.status ==
                  'in_progress' %}
                  <span class="status-badge status-building pulse-animation">
                    <i class="fas fa-spinner fa-spin"></i> Building
                  </span>
                  {% else %}
                  <span class="status-badge status-failed">
                    <i class="fas fa-times-circle"></i> Failed
                  </span>
                  {% endif %}
                </div>
              </div>

              <div class="text-muted mb-3 small">
                <div class="d-flex flex-wrap gap-3">
                  <div>
                    <i class="fab fa-github me-1"></i>
                    <span
                      class="text-truncate"
                      style="max-width: 200px; display: inline-block"
                    >
                      {{ build.repo_url }}
                    </span>
                  </div>
                  <div>
                    <i class="fas fa-code-branch me-1"></i> {{ build.branch }}
                  </div>
                  <div>
                    <i class="far fa-calendar-alt me-1"></i>
                    {{ build.start_time.split('T')[0] }}
                  </div>
                </div>
              </div>

              <div class="d-flex gap-2">
                <a
                  href="{{ url_for('build_log', build_id=build.id) }}"
                  class="btn btn-sm btn-outline-secondary"
                >
                  <i class="fas fa-file-alt me-1"></i> View Log
                </a>

                {% if build.status == 'completed' %}
                <a
                  href="{{ url_for('download_build', build_id=build.id) }}"
                  class="btn btn-sm btn-success"
                >
                  <i class="fas fa-download me-1"></i> Download IPA
                </a>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="card-body p-5 text-center">
            <i class="fas fa-folder-open fa-3x mb-3 text-muted"></i>
            <h5>No builds yet</h5>
            <p class="text-muted">
              Start a new build using the form on the left
            </p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
