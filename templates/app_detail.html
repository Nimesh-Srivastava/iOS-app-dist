{% extends 'base.html' %} {% block title %}{{ app.name }} - AppCenter{% endblock
%} {% block content %}
<div class="container">
	<!-- Back button and app title -->
	<div class="d-flex align-items-center mb-4">
		<a
			href="{{ url_for('app.index') }}"
			class="btn btn-sm btn-outline-secondary me-3"
		>
			<i class="fas fa-arrow-left me-1"></i> Back to Apps
		</a>
		<h1 class="mb-0 fw-bold">{{ app.name }}</h1>
		<span class="badge bg-primary ms-3 align-self-center"
			>v{{ app.version }}</span
		>
	</div>

	<div class="row">
		<div class="col-lg-4">
			<!-- App Info Card -->
			<div class="card mb-4 border-0 shadow-sm">
				<div class="card-body text-center p-4">
					<img
						src="{{ app.icon }}"
						alt="{{ app.name }}"
						class="app-icon mb-4"
						style="width: 120px; height: 120px"
					/>

					{% if app.bundle_id %}
					<p class="text-muted mb-3">{{ app.bundle_id }}</p>
					{% endif %} {% if app.source %}
					<div class="mb-3">
						<span class="badge bg-secondary">
							<i class="fab fa-github me-1"></i> GitHub Build
						</span>
					</div>
					{% endif %}

					<div
						class="d-flex justify-content-between small text-muted mb-4"
					>
						<div>
							<i class="far fa-calendar-alt me-1"></i>
							{% if app.upload_date %} {{
							app.upload_date.split('T')[0] }} {% elif
							app.creation_date %} {{
							app.creation_date.split('T')[0] }} {% else %}
							Unknown {% endif %}
						</div>
						<div>
							<i class="fas fa-file-archive me-1"></i>
							{% if app.size %} {{ (app.size / 1024 / 1024) |
							round(2) }} MB {% else %} Unknown {% endif %}
						</div>
					</div>

					<div class="d-grid gap-2">
						<a
							href="{{ url_for('app.install', app_id=app.id) }}"
							class="btn btn-primary"
						>
							<i class="fas fa-download me-2"></i> Install App
						</a>
						<a
							href="{{ url_for('app.direct_install', app_id=app.id) }}"
							class="btn btn-outline-primary"
						>
							<i class="fas fa-file-download me-2"></i> Direct
							Download
						</a>
					</div>
					{% if g.user and g.user.role in ['admin', 'developer'] %}
					<hr class="my-4" />
					<div class="d-grid gap-2">
						<a
							href="{{ url_for('app.manage_sharing', app_id=app.id) }}"
							class="btn btn-info"
						>
							<i class="fas fa-share-alt me-2"></i> Manage Sharing
						</a>
					</div>
					{% endif %} {% if g.user and g.user.role in ['admin'] %}
					<hr class="my-4" />
					<div class="d-grid gap-2">
						<a
							href="{{ url_for('app.edit_app', app_id=app.id) }}"
							class="btn btn-secondary"
						>
							<i class="fas fa-edit me-2"></i> Edit Details
						</a>

						<form
							action="{{ url_for('app.delete_app', app_id=app.id) }}"
							method="post"
							onsubmit="return confirm('Are you sure you want to delete this app? This action cannot be undone.')"
						>
							<button
								type="submit"
								class="btn btn-danger w-100 mt-2"
							>
								<i class="fas fa-trash-alt me-2"></i> Delete App
							</button>
						</form>
					</div>
					{% endif %}
				</div>
			</div>

			{% if g.user and g.user.role in ['admin', 'developer'] %}
			<!-- App Sharing Quick Actions -->
			<div class="card mb-4 border-0 shadow-sm">
				<div class="card-header">
					<h5 class="mb-0">
						<i class="fas fa-share-alt me-2"></i> App Sharing
					</h5>
				</div>
				<div class="card-body p-4">
					{% if shared_users %}
					<div class="list-group list-group-flush">
						{% for username in shared_users %}
						<div
							class="list-group-item bg-transparent d-flex justify-content-between align-items-center"
						>
							<span
								><i class="fas fa-user me-2 text-muted"></i>{{
								username }}</span
							>
							{% if not (g.user.role == 'developer' and username
							== g.user.username) %}
							<form
								action="{{ url_for('app.unshare_app', app_id=app.id, username=username) }}"
								method="post"
								class="d-inline"
							>
								<button
									type="submit"
									class="btn btn-sm btn-outline-danger"
									onclick="return confirm('Remove access for {{ username }}?')"
								>
									<i class="fas fa-times"></i>
								</button>
							</form>
							{% endif %}
						</div>
						{% endfor %}
					</div>
					{% else %}
					<div class="alert alert-secondary mb-0">
						<i class="fas fa-info-circle me-2"></i> This app is not
						shared with any users.
					</div>
					{% endif %}
				</div>
			</div>
			{% endif %}
		</div>

		<div class="col-lg-8">
			<!-- Version History -->
			<div class="card mb-4 border-0 shadow-sm">
				<div class="card-header">
					<h5 class="mb-0">
						<i class="fas fa-history me-2"></i> Version History
					</h5>
				</div>
				<div class="card-body p-0">
					{% if app.versions %}
					<div class="table-responsive">
						<table class="table table-hover mb-0">
							<thead>
								<tr>
									<th scope="col">Version</th>
									<th scope="col">Upload Date</th>
									<th scope="col">Size</th>
									<th scope="col" class="text-end">Action</th>
								</tr>
							</thead>
							<tbody>
								{% for version in
								app.versions|sort(attribute='upload_date',
								reverse=true) %}
								<tr>
									<td>
										<span class="fw-semibold"
											>{{ version.version }}</span
										>
										{% if loop.first %}
										<span class="badge bg-success ms-2"
											>Latest</span
										>
										{% endif %}
									</td>
									<td>
										{{ version.upload_date.split('T')[0] }}
									</td>
									<td>
										{{ (version.size / 1024 / 1024)|round(2)
										}} MB
									</td>
									<td class="text-end">
										<a
											href="{{ url_for('app.download_app', app_id=app.id, filename=version.filename) }}"
											class="btn btn-sm btn-outline-primary"
										>
											<i class="fas fa-download me-1"></i>
											Download
										</a>
									</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
					{% else %}
					<div class="alert alert-info m-3">
						<i class="fas fa-info-circle me-2"></i> No version
						history available
					</div>
					{% endif %}
				</div>
			</div>

			<!-- Installation Help Button -->
			<div class="d-grid gap-2 mb-4">
				<button
					type="button"
					class="btn btn-outline-info"
					data-bs-toggle="modal"
					data-bs-target="#installationInstructionsModal"
				>
					<i class="fas fa-info-circle me-2"></i> Installation Instructions
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Installation Instructions Modal -->
<div
	class="modal fade"
	id="installationInstructionsModal"
	tabindex="-1"
	aria-labelledby="installationModalLabel"
	aria-hidden="true"
>
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="installationModalLabel">
					<i class="fas fa-download me-2"></i> Installation Instructions
				</h5>
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="modal"
					aria-label="Close"
				></button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-md-6">
						<div class="card mb-3">
							<div class="card-header bg-primary text-white">
								<i class="fab fa-apple me-2"></i> iOS Devices (iPhone/iPad)
							</div>
							<div class="card-body">
								<ol class="ps-3 mt-2">
									<li class="mb-2">
										Open this page in <strong>Safari</strong> on
										your iOS device
									</li>
									<li class="mb-2">
										Tap the <strong>"Install App"</strong> button
										above
									</li>
									<li class="mb-2">
										When prompted, tap <strong>"Install"</strong> to
										confirm
									</li>
									<li class="mb-2">
										Go to
										<strong>Settings > General > Device Management</strong>
									</li>
									<li class="mb-2">
										Trust the developer profile for this app
									</li>
									<li>Launch the app from your home screen</li>
								</ol>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card mb-3">
							<div class="card-header bg-secondary text-white">
								<i class="fas fa-laptop me-2"></i> Manual Installation
							</div>
							<div class="card-body">
								<ol class="ps-3 mt-2">
									<li class="mb-2">
										Click <strong>"Direct Download"</strong> to
										download the IPA file
									</li>
									<li class="mb-2">
										Use iTunes, Apple Configurator, or a similar
										tool to install the app
									</li>
									<li>
										Follow the instructions provided by your chosen
										installation tool
									</li>
								</ol>
							</div>
						</div>
					</div>
				</div>
				
				<div class="alert alert-info mt-3">
					<i class="fas fa-lightbulb me-2"></i> <strong>Tip:</strong> For enterprise distribution, 
					users need to trust the enterprise developer certificate on their device before 
					they can install and run the app.
				</div>
			</div>
			<div class="modal-footer">
				<button
					type="button"
					class="btn btn-secondary"
					data-bs-dismiss="modal"
				>
					Close
				</button>
			</div>
		</div>
	</div>
</div>
{% endblock %}
